<html>
	<head>
		<script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
		<script src="SermonArchiveAPI.js"></script>
		<script
  src="https://code.jquery.com/jquery-3.5.0.min.js"
  integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
  crossorigin="anonymous"></script>
	</head>
	<body>
		<div id="SermonList">
			<b>Status: </b><input id="status" readonly type="text" value="Loading..." /><br />
			<b>Current Page: </b><input id="page" readonly type="text" value="1" /> of <b id="totalPages"></b><br />
			<input disabled id="prev" type="button" value="Previous Page" onclick="GWCSermonList.PreviousPage();" />
			<input id="next" type="button" value="Next Page" onclick="GWCSermonList.NextPage();" />
			<br/><br/>
			<div id="Sermons" class="ccm-block-page-list-pages"></div>
			<div id="Sermon"></div>
		</div>
	</body>
	<footer>
		<script>
			var dateFormat = new Intl.DateTimeFormat('en-US', {
				weekday: 'long',
				year: 'numeric',
				month: 'long',
				day: 'numeric'
			});
			var sermonsContainer = document.getElementById('Sermons');
			var sermonContainer = document.getElementById('Sermon');
			function DisplaySermons(Sermons) {
				//Clear anything alredy in the Container
				sermonsContainer.innerHTML = "";
				
				//Loop through each sermon and output it.
				for (i = 0; i < Sermons.length; i++) {
					var Sermon = Sermons[i];
					var sermonsHTML = '' + 
						'<div class="col-sm-6 ccm-block-page-list-page-entry">' +
							'<div class="ccm-block-page-list-page-entry-text">' +
								'<div class="ccm-block-page-list-title">' +
									'<h3><a href="#" class="sermon-link" onclick="DisplaySermon(' + Sermon.year + ", '" + Sermon.date + "'" + ');">' + Sermon.info.title + '</a></h3>' +
								'</div>' +
								'<div class="ccm-block-page-list-date">' +
									'<h4 class="text-muted">' + dateFormat.format(new Date(Sermon.date)) + '</h4>' +
								'</div>' +
								'<div class="ccm-block-page-list-sermon-info">' +
									'<address>' +
										'<strong>Speaker:</strong> ' + Sermon.info.speaker + '<br />' +
										'<strong>Scripture:</strong> ' + Sermon.info.scripture + '<br />' +
										'<a href="#" class="sermon-link btn btn-default" onclick="DisplaySermon(' + Sermon.year + ", '" + Sermon.date + "'" + ');">View Sermon Â»</a>' +
									'</address>' +
								'</div>' +
							'</div>' +
						'</div>';

					document.getElementById('Sermons').innerHTML += sermonsHTML;
				}
			}
			
			function DisplaySermon(year, date) {
				//Hide Sermon List
				sermonsContainer.setAttribute("style", "display: none;");
				//Display Sermon
				sermonContainer.setAttribute("style", "display: initial;");
				
				//Get specific sermon
				var Sermons = GWCSermonList.getSermons();
				//Check through sermon array to find sermon. If it's found get scripture
				Sermons.some(function(sermon) {
					if(sermon.year === year) {
						if(sermon.date === date) {
							var sermonHTML = '' +
								'<div class="row">' +
									'<div class="col-sm-8 col-md-9">' +
										'<h1 class="page-title">' + sermon.info.title + '</h1>' +
									'</div>' +
									'<div class="col-sm-4 col-md-3">' +
										'<a href="#" class="btn btn-default" onclick="BackToList();">Back to List</a>' +
									'</div>' +
								'</div>' +
								'<div class="row">' +
									'<div class="col-sm-5 col-md-4">' +
										'<h3>' + dateFormat.format(new Date(sermon.date)) + '</h3>' +
										'<h3>' + sermon.info.speaker + '</h3><p></p>' +
										'<div id="ScriptureContainer">' +
											'<div class="panel-group" id="scriptureaccordion" role="tablist">' +
												'<div class="panel panel-default">' +
													'<div class="panel-heading" role="tab" id="scriptureheading">' +
														'<h4 class="panel-title">' +
															'<a href="#scripture" role="button" data-toggle="collapse" data-parent="#scriptureaccordion" aria-expanded="false" aria-controls="scripture">Click to See Main Scripture</a>' +
														'</h4>' +
													'</div>' +
													'<div id="scripture" class="panel-collapse collapse" role="tabpenal" aria-labelledby="scriptureheading">' +
														'<div class="panel-body">' +
															'<center><b>Book Chapter (John 3)</b></center><br>' +
															'<p class="ltr">  ' +
																'<small class="ltr">34</small>  Verse goes here' +
																'<br>  <small class="ltr">35</small>  Verse will go here' +
															'</p>' +
														'</div>' +
													'</div>' +
												'</div>' +
											'</div>' +
										'</div>' +
									'</div>' +
									'<div class="col-sm-7 col-md-8">' +
										'<ul class="nav nav-tabs" role="tablist">' +
											'<li role="presentation" class="active">' +
												'<a href="#video" aria-controls="video" role="tab" data-toggle="tab">Watch Video</a>' +
											'</li>' +
											'<li role="presentation">' +
												'<a href="#audio" aria-controls="audio" role="tab" data-toggle="tab">Listen to Audio</a>' +
											'</li>' +
										'</ul>' +
										'<div class="tab-content">' +
											'<div class="tab-pan active" id="video" role="tabpanel">' +
												'<div style="text-align:center; margin-top: 20px; margin-bottom: 20px;">' +
													'<video controls="controls" style="max-width: 100%;">' +
														'<source src="' + sermon.info.videoURL + '" type="video/mp4">' +
														"Your browser doesn't support the HTML5 video tag." +
													'</video>' +
												'</div>' +
											'</div>' +
											'<div class="tab-pane" id="audio" role="tabpanel">' +
												'<div style="text-align:center; margin-top: 20px; margin-bottom: 20px;">' +
													'<audio controls="controls" style="max-width: 100%;">' +
														'<source src="' + sermon.info.audioURL + '" type="audio/mp3">' +
														"Your browser doesn't support the HTML5 audio tag." +
													'</audio>' +
												'</div>' +
											'</div>' +
										'</div>' +
									'</div>' +
								'</div>';
							sermonContainer.innerHTML = sermonHTML;
							GetScripture(sermon.info.scripture);
							return true;
						}
					}
				});
			}
			
			function BackToList() {
				//Hide Individual Sermon
				sermonContainer.setAttribute("style", "display: none;");
				//Display Sermon List
				sermonsContainer.setAttribute("style", "display: initial;");
			}
			
			function GetScripture(scripture) {
				jQuery.ajax({
					url:'https://getbible.net/json?scrip=' + scripture,
					dataType: 'jsonp',
					jsonp: 'getbible',
					success:function(json){
							// Remove loading animation
							jQuery('#scripture .panel-body').empty();
							// set text direction
							if (json.direction == 'RTL'){
								var direction = 'rtl';
							} else {
								var direction = 'ltr'; 
							}
							// check response type
							if (json.type == 'verse'){
									var output = '';
										jQuery.each(json.book, function(index, value) {
												output += '<center><b>'+value.book_name+' '+value.chapter_nr+'</b></center><br/><p class="'+direction+'">';
													jQuery.each(value.chapter, function(index, value) {
															output += '  <small class="ltr">' +value.verse_nr+ '</small>  ';
															output += value.verse;
															output += '<br/>';
													});
													output += '</p>';
										});
									jQuery('#scripture .panel-body').html(output);  // <---- this is the div id we update
							} else if (json.type == 'chapter'){
									var output = '<center><b>'+json.book_name+' '+json.chapter_nr+'</b></center><br/><p class="'+direction+'">';
									jQuery.each(json.chapter, function(index, value) {
											output += '  <small class="ltr">' +value.verse_nr+ '</small>  ';
											output += value.verse;
											output += '<br/>';
									});
									output += '</p>';
									jQuery('#scripture .panel-body').html(output);  // <---- this is the div id we update
							} else if (json.type == 'book'){
									var output = '';
									jQuery.each(json.book, function(index, value) {
											output += '<center><b>'+json.book_name+' '+value.chapter_nr+'</b></center><br/><p class="'+direction+'">';
											jQuery.each(value.chapter, function(index, value) {
													output += '  <small class="ltr">' +value.verse_nr+ '</small>  ';
													output += value.verse;
													output += '<br/>';
											});
									output += '</p>';
							});
							if(addTo){
								jQuery('#scripture .panel-body').html(output);  // <---- this is the div id we update
							}
						}
					},
					error:function(){
							jQuery('#scripture .panel-body').html('<h2>No scripture was returned, please try again!</h2>'); // <---- this is the div id we update
					 },
				});
			}
			
			var SermonListOptions = {
				Region: 'us-east-1',
				Identity:'us-east-1:53e682d9-0102-4330-9a82-31216cc10dc4',
				onSermonArchiveError: function(data) {
					document.getElementById('textarea').innerHTML = data.msg;
				},
				onSermonArchiveInit: function() {
					document.getElementById('status').value = "Inititalizing...";
				},
				afterSermonArchiveInit: function(data) {
					document.getElementById('totalPages').innerHTML = data.LastPage;
				},
				onSermonArchiveRequest: function() {
					document.getElementById('status').value = "Querying Database...";
				},
				afterSermonArchiveRequest: function(data) {
					var sermonsToDisplay = data.Sermons.slice(((data.CurrentPage * data.PerPage) - data.PerPage), (data.CurrentPage * data.PerPage));
					document.getElementById('status').value = "Loaded from " + data.Source + ".";
					//Disable Next Page Button if on last page
					if(data.LastPage == data.CurrentPage) {
						document.getElementById('next').disabled = true;
					} else {
						document.getElementById('next').disabled = false;
					}
					//Disable Previous Page Button on first page
					if(data.CurrentPage == 1) {
						document.getElementById('prev').disabled = true;
					} else {
						document.getElementById('prev').disabled = false;
					}
					//Display Sermon List
					sermonsContainer.setAttribute("style", "display: initial;");
					//Hide Individual Sermon
					sermonContainer.setAttribute("style", "display: none;");
					
					document.getElementById('page').value = data.CurrentPage;
					DisplaySermons(sermonsToDisplay);
				}
			};
			var GWCSermonList = new SermonList(SermonListOptions);
		</script>
	</footer>
</html>
